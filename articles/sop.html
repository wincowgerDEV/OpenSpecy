<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="OpenSpecy">
<title>Open Specy Tutorial • OpenSpecy</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Open Specy Tutorial">
<meta property="og:description" content="OpenSpecy">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">OpenSpecy</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/sop.html">Open Specy Tutorial</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/wincowgerDEV/OpenSpecy-package/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Open Specy Tutorial</h1>
                        <h4 data-toc-skip class="author"></h4>
<p>Jessica
Meyers, Jeremy Conkle, Win Cowger, Zacharias Steinmetz, Andrew Gray,
Chelsea Rochman, Sebastian Primpke, Jennifer Lynch, Hannah Hapich,
Hannah De Frond, Keenan Munno, Bridget O’Donnell</p>
            
            <h4 data-toc-skip class="date">2023-08-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/wincowgerDEV/OpenSpecy-package/blob/HEAD/vignettes/sop.Rmd" class="external-link"><code>vignettes/sop.Rmd</code></a></small>
      <div class="d-none name"><code>sop.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="document-overview">Document Overview<a class="anchor" aria-label="anchor" href="#document-overview"></a>
</h2>
<p>checkThis document outlines a common workflow for using the Open
Specy package and app and highlights some topics that users are often
requesting a tutorial on. If the document is followed sequentially from
beginning to end, the user will have a better understanding of every
procedure involved in using Open Specy R package and app as a tool for
interpreting spectra. It takes approximately 45 minutes to read through
and follow along with this standard operating procedure the first time.
Afterward, knowledgeable users should be able to thoroughly analyze
individual spectra at an average speed of 1 min<sup>-1</sup>.</p>
</div>
<div class="section level2">
<h2 id="r-package-and-app">R Package and App<a class="anchor" aria-label="anchor" href="#r-package-and-app"></a>
</h2>
<p>Here we will describe common workflows of spectral analysis using the
Open Specy R package and App.</p>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>After installing the R package, you just need to read in the
library.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/wincowgerDEV/OpenSpecy-package/" class="external-link">OpenSpecy</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="running-the-app">Running the App<a class="anchor" aria-label="anchor" href="#running-the-app"></a>
</h3>
<p>To get started with the Open Specy user interface, access <a href="https://openanalysis.org/openspecy/" class="external-link">https://openanalysis.org/openspecy/</a>
or start the Shiny GUI directly from R typing</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run_app.html">run_app</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="reading-data">Reading Data<a class="anchor" aria-label="anchor" href="#reading-data"></a>
</h3>
<p>If you have your own data, click the <strong>Upload File</strong> tab
at the top of the page.</p>
<p><img src="mainpage.jpg" width="98%" style="display: block; margin: auto;"></p>
<div class="section level4">
<h4 id="choose-whether-to-share-your-uploaded-data-or-not">Choose whether to share your uploaded data or not<a class="anchor" aria-label="anchor" href="#choose-whether-to-share-your-uploaded-data-or-not"></a>
</h4>
<p><img src="uploadfile.jpg" width="144" style="display: block; margin: auto;"></p>
<p>Before uploading, indicate if you would like to share the uploaded
data or not using the slider. If selected, any data uploaded to the tool
will automatically be shared under <a href="https://creativecommons.org/licenses/by/4.0/" class="external-link">CC-BY 4.0
license</a> and will be available for researchers and other ventures to
use to improve spectral analysis, build machine learning tools, etc.
Some users may choose not to share if they need to keep their data
private. If switched off, none of the uploaded data will be stored or
shared in Open Specy.</p>
</div>
<div class="section level4">
<h4 id="uploadread-data">Upload/Read Data<a class="anchor" aria-label="anchor" href="#uploadread-data"></a>
</h4>
<p>Open Specy allows for upload of native Open Specy .y(a)ml, .json, or
.rds files. In addition, .csv, .asp, .jdx, .0, .spa, .spc, and .zip
files with ENVI data can be imported. Open Specy and .csv files should
always load correctly but the other file types are still in beta
development, though most of the time these files work perfectly. It is
best practice to cross check files in the proprietary software they came
from and Open Specy before use in Open Specy. Due to the complexity of
these file types, we haven’t been able to make them fully compatible
yet. If your file is not working, please contact the administrator and
share the file so that we can get it to work.</p>
<p>For the most consistent results, files should be converted to .csv
format before uploading to Open Specy. The specific steps to converting
your instrument’s native files to .csv can be found in its software
manual or you can check out <a href="https://www.effemm2.de/spectragryph/" class="external-link">Spectragryph</a>, which
supports many spectral file conversions (see Mini Tutorial section: File
conversion in Spectragryph to Open Specy accepted format).</p>
<p>If uploading a .csv file, label the column with the wavenumbers
<code>wavenumber</code> and name the column with the intensities
<code>intensity</code>.</p>
<table class="table">
<caption>Sample data <code>raman_hdpe</code>
</caption>
<thead><tr class="header">
<th align="right">wavenumber</th>
<th align="right">intensity</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">301.040</td>
<td align="right">26</td>
</tr>
<tr class="even">
<td align="right">304.632</td>
<td align="right">50</td>
</tr>
<tr class="odd">
<td align="right">308.221</td>
<td align="right">48</td>
</tr>
<tr class="even">
<td align="right">311.810</td>
<td align="right">45</td>
</tr>
<tr class="odd">
<td align="right">315.398</td>
<td align="right">46</td>
</tr>
<tr class="even">
<td align="right">318.983</td>
<td align="right">42</td>
</tr>
</tbody>
</table>
<p>Wavenumber units must be cm<sup>-1</sup>. Any other columns are not
used by the software. Always keep a copy of the original file before
alteration to preserve metadata and raw data for your records.</p>
<p>To upload data, click <strong>Browse</strong> and choose one of your
files to upload, or drag and drop your file into the gray box. At this
time you can only upload one file at a time.</p>
</div>
<div class="section level4">
<h4 id="share-data">Share data<a class="anchor" aria-label="anchor" href="#share-data"></a>
</h4>
<p>When the user clicks the <strong>Share Data</strong> button their
current uploaded data and metadata is sent to an <a href="https://osf.io/rjg3c/" class="external-link">open-access online repository</a>.</p>
<p><img src="sharemetadata.jpg" width="75" style="display: block; margin: auto;"></p>
<p>All high quality uploaded data with metadata will eventually be
reviewed by spectroscopy experts and added to the internal library if it
passes review. If multiple files are going to be uploaded with metadata,
the cells will also stay filled with the last input after the share data
button is clicked. Just upload the next dataset and change the metadata
inputs that are different. If more than 50 files will be shared at once,
you can contact the website administrator to get a bulk upload sheet for
more rapid upload.</p>
<p>The following line of code will read in your data when using the
package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_multi.html">read_any</a></span><span class="op">(</span><span class="st">"path/to/your/data"</span><span class="op">)</span></span></code></pre></div>
<p>The following R functions from the Open Specy package will also read
in spectral data accordingly if you have a particular format in
mind:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_ext.html">read_text</a></span><span class="op">(</span><span class="st">".csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/read_ext.html">read_asp</a></span><span class="op">(</span><span class="st">".asp"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/read_opus.html">read_opus</a></span><span class="op">(</span><span class="st">".0"</span><span class="op">)</span></span></code></pre></div>
<p>Supported formats are .asp, .csv, .jdx, .spc, .spa, .0, .json, .yml,
.rds, and .zip. If you use a .zip, Open Specy will assume that the data
are either a suite of spectra as individual files and merge them into
one <code>OpenSpecy</code> object, or it will assume it is a
hyperspectral map in the form of an ENVI file (.hdr and .dat) and read
in the map data.</p>
<p>If you don’t have your own data you can use a test dataset.</p>
<p><img src="samplefile.jpg" width="69" style="display: block; margin: auto;"></p>
<p>If you don’t have your own data to use right away, that is ok. You
can download test data to try out the tool by clicking on the test data
button. A .csv file of HDPE Raman spectrum will download on your
computer. This file can also be used as a template for formatting .csv
data into an Open Specy accepted format. The following line of code does
the same to load the example file into R:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"raman_hdpe"</span><span class="op">)</span></span></code></pre></div>
<p>We also have onboard files in common that you can call to test
different formats:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spectral_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ext.html">read_extdata</a></span><span class="op">(</span><span class="st">"CA_tiny_map.zip"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/read_multi.html">read_any</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># preserves some metadata</span></span>
<span><span class="va">asp_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ext.html">read_extdata</a></span><span class="op">(</span><span class="st">"ftir_ldpe_soil.asp"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/read_multi.html">read_any</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">ps_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ext.html">read_extdata</a></span><span class="op">(</span><span class="st">"ftir_ps.0"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/read_multi.html">read_any</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># preserves some metadata</span></span>
<span><span class="va">spc_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ext.html">read_extdata</a></span><span class="op">(</span><span class="st">"raman_atacamit.spc"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/read_multi.html">read_any</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">csv_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ext.html">read_extdata</a></span><span class="op">(</span><span class="st">"raman_hdpe.csv"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/read_multi.html">read_any</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">json_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ext.html">read_extdata</a></span><span class="op">(</span><span class="st">"raman_hdpe.json"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/read_multi.html">read_any</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># read in exactly as an OpenSpecy object</span></span>
<span><span class="va">rds_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ext.html">read_extdata</a></span><span class="op">(</span><span class="st">"raman_hdpe.rds"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/read_multi.html">read_any</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># read in exactly as an OpenSpecy object</span></span>
<span><span class="va">yml_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ext.html">read_extdata</a></span><span class="op">(</span><span class="st">"raman_hdpe.yml"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/read_multi.html">read_any</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># read in exactly as an OpenSpecy object</span></span>
<span><span class="va">batch_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ext.html">read_extdata</a></span><span class="op">(</span><span class="st">"testdata_zipped.zip"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/read_multi.html">read_any</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>You will notice now that the R package reads in files into an object
with class <code>OpenSpecy</code>. This is a class we created to
optimize the batch analysis and preserving spectral metadata. You can
even create these from scratch if you’d like:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scratch_OpenSpecy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_OpenSpecy.html">as_OpenSpecy</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1000</span>,<span class="fl">2000</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, </span>
<span>                                  spectra <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">201</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                                  metadata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>file_name <span class="op">=</span> <span class="st">"fake_noise"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>We have some generic functions built for inspecting the spectra:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">scratch_OpenSpecy</span><span class="op">)</span> <span class="co"># shows the raw object</span></span>
<span><span class="co">#&gt;      wavenumber runif.n...201.</span></span>
<span><span class="co">#&gt;   1:       1000      0.5126488</span></span>
<span><span class="co">#&gt;   2:       1005      0.6624907</span></span>
<span><span class="co">#&gt;   3:       1010      0.7085160</span></span>
<span><span class="co">#&gt;   4:       1015      0.5305307</span></span>
<span><span class="co">#&gt;   5:       1020      0.8153238</span></span>
<span><span class="co">#&gt;  ---                          </span></span>
<span><span class="co">#&gt; 197:       1980      0.5137661</span></span>
<span><span class="co">#&gt; 198:       1985      0.4308666</span></span>
<span><span class="co">#&gt; 199:       1990      0.1543351</span></span>
<span><span class="co">#&gt; 200:       1995      0.4750912</span></span>
<span><span class="co">#&gt; 201:       2000      0.9235614</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $metadata</span></span>
<span><span class="co">#&gt;    x y  file_name                          file_id         col_id</span></span>
<span><span class="co">#&gt; 1: 1 1 fake_noise 5306eb44a1ec7c095f9573a40cfc6e95 runif.n...201.</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">scratch_OpenSpecy</span><span class="op">)</span> <span class="co"># summarizes the contents of the spectra</span></span>
<span><span class="co">#&gt; $wavenumber</span></span>
<span><span class="co">#&gt;  Length Min. Max. Res.</span></span>
<span><span class="co">#&gt;     201 1000 2000    5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $spectra</span></span>
<span><span class="co">#&gt;  Number Min. Intensity Max. Intensity</span></span>
<span><span class="co">#&gt;       1     0.01405911       0.997506</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $metadata</span></span>
<span><span class="co">#&gt;   Min. Max.</span></span>
<span><span class="co">#&gt; x    1    1</span></span>
<span><span class="co">#&gt; y    1    1</span></span>
<span><span class="co">#&gt; [1] "x"         "y"         "file_name" "file_id"   "col_id"</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">scratch_OpenSpecy</span><span class="op">)</span> <span class="co"># shows the top wavenumbers and intensities</span></span>
<span><span class="co">#&gt;    wavenumber runif.n...201.</span></span>
<span><span class="co">#&gt; 1:       1000      0.5126488</span></span>
<span><span class="co">#&gt; 2:       1005      0.6624907</span></span>
<span><span class="co">#&gt; 3:       1010      0.7085160</span></span>
<span><span class="co">#&gt; 4:       1015      0.5305307</span></span>
<span><span class="co">#&gt; 5:       1020      0.8153238</span></span>
<span><span class="co">#&gt; 6:       1025      0.8459946</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h3>
<div class="section level4">
<h4 id="spectra">Spectra<a class="anchor" aria-label="anchor" href="#spectra"></a>
</h4>
<p>In the app after spectral data are uploaded, it will appear in the
main window. This plot is selectable, zoomable, and provides information
on hover. You can also save a .png file of the plot view using the
camera icon at the top right when you hover over the plot. This plot
will change the view based on updates from the <strong>Intensity
Adjustment</strong> selection.</p>
<p>We have two ways to visualize your spectra, one is quick and
efficient and the other is interactive.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">scratch_OpenSpecy</span><span class="op">)</span> <span class="co"># quick and efficient</span></span></code></pre></div>
<p><img src="sop_files/figure-html/unnamed-chunk-15-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/interactive_plots.html">plotly_spec</a></span><span class="op">(</span><span class="va">scratch_OpenSpecy</span><span class="op">)</span> <span class="co"># this will min-max normalize your data even</span></span>
<span>                               <span class="co"># if it isn't already but are not changing your</span></span>
<span>                               <span class="co"># underlying data</span></span>
<span></span>
<span><span class="fu"><a href="../reference/interactive_plots.html">plotly_spec</a></span><span class="op">(</span><span class="va">scratch_OpenSpecy</span>, <span class="va">rds_example</span><span class="op">)</span> <span class="co"># interactive comparison</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="maps">Maps<a class="anchor" aria-label="anchor" href="#maps"></a>
</h4>
<p>Spectral maps can also be visualized as overlaid spectra but in
addition the spatial information can be plotted as a heatmap. A similar
plot should appear in the app if you upload multiple spectra or a
spectral map. It is important to note that when multiple spectra are
uploaded in batch they are prescribed <code>x</code> and <code>y</code>
coordinates, this can be helpful for visualizing summary statistics and
navigating vast amounts of data but shouldn’t be confused with data
which actually has spatial coordinates.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/interactive_plots.html">heatmap_spec</a></span><span class="op">(</span><span class="va">spectral_map</span>,</span>
<span>             z <span class="op">=</span> <span class="va">spectral_map</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">x</span><span class="op">)</span> <span class="co"># will show more advanced example</span></span>
<span>                                          <span class="co"># later in tutorial</span></span>
<span></span>
<span><span class="fu"><a href="../reference/interactive_plots.html">interactive_plot</a></span><span class="op">(</span><span class="va">spectral_map</span>, select <span class="op">=</span> <span class="fl">100</span>, z <span class="op">=</span> <span class="va">spectral_map</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="processing">Processing<a class="anchor" aria-label="anchor" href="#processing"></a>
</h3>
<p>After uploading data, you can preprocess the data using intensity
adjustment, baseline correction, smoothing, flattening, and range
selection and save your preprocessed data. Once the process button is
selected the default processing will initiate. This is an absolute
derivative transformation, it is kind of magic, it does something
similar to smoothing, baseline subtraction, and intensity correction
simultaneously and really quickly.</p>
<p><img src="preprocessplot.png" width="300" style="display: block; margin: auto;"></p>
<p>The plot in the app will update on the fly with the processed
spectra. If you want to see the unprocessed spectra just deselect
processing. It will also automatically update with any new inputs. This
allows the user to tune the inputs to optimize the signal to noise
ratio. The goal with preprocessing is to make peak regions have high
intensities and non-peak regions should have low intensities. If
preprocessing a spectral map or in batch, we recommend to tune the
parameters so that you maximize the number of spectra over your signal
to noise ratio before you start identification. Spectra below the signal
to noise ratio will show up black. There is also a running fill bar that
will tell you what percent of your spectra are above the signal to noise
ratio.</p>
<p>The R function that is the backbone of the app is a monolithic
function for all processing procedures which is optimized by default to
result in high signal to noise in most cases.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_spec.html">process_spec</a></span><span class="op">(</span><span class="va">raman_hdpe</span><span class="op">)</span></span></code></pre></div>
<p>You can compare the processed and unprocessed data:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/interactive_plots.html">plotly_spec</a></span><span class="op">(</span><span class="va">raman_hdpe</span>, <span class="va">processed</span><span class="op">)</span></span></code></pre></div>
<p>We want people to use the <code><a href="../reference/process_spec.html">process_spec()</a></code> function for
most processing operations, all processing functions can be tuned using
its parameters. However, we recognize that nesting of functions and
order of operations can be useful for users to control so you can also
use individual functions for each operation if you’d like.</p>
<p><img src="smoothing.jpg" width="126" style="display: block; margin: auto;"></p>
<p>When the slider is green for the tool type, that means that that tool
is being used to preprocess the spectrum. If the slider is clicked
blank, the cog button to the right will disappear to indicate that the
tool is no longer being used.</p>
<p><img src="deselection.jpg" width="74" style="display: block; margin: auto;"></p>
<p>If the cog button is clicked, any functions associated with that tool
will be displayed and can be manipulated to process the spectrum.</p>
<div class="section level5">
<h5 id="intensity-adjustment">Intensity Adjustment<a class="anchor" aria-label="anchor" href="#intensity-adjustment"></a>
</h5>
<p><img src="intensityadjustment.jpg" width="76" style="display: block; margin: auto;"></p>
<p>Open Specy assumes that intensity units are in absorbance units but
Open Specy can adjust reflectance or transmittance spectra to absorbance
units using this selection in the upload file tab. The transmittance
adjustment uses the <span class="math inline">\(\log_{10} 1/T\)</span>
calculation which does not correct for system or particle
characteristics. The reflectance adjustment use the Kubelka-Munk
equation <span class="math inline">\(\frac{(1-R)^2}{2R}\)</span>. If
none is selected, Open Specy assumes that the uploaded data is an
absorbance spectrum and does not apply an adjustment.</p>
<p>This is the respective R code:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raman_adj</span> <span class="op">&lt;-</span> <span class="va">raman_hdpe</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/adj_intens.html">adj_intens</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">raman_adj</span><span class="op">)</span></span>
<span><span class="co">#&gt;    wavenumber  intensity</span></span>
<span><span class="co">#&gt; 1:    301.040 0.00000000</span></span>
<span><span class="co">#&gt; 2:    304.632 0.03037975</span></span>
<span><span class="co">#&gt; 3:    308.221 0.02784810</span></span>
<span><span class="co">#&gt; 4:    311.810 0.02405063</span></span>
<span><span class="co">#&gt; 5:    315.398 0.02531646</span></span>
<span><span class="co">#&gt; 6:    318.983 0.02025316</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="conforming">Conforming<a class="anchor" aria-label="anchor" href="#conforming"></a>
</h5>
<p>Conforming spectra is essential before comparing to a reference
library and can be useful for summarizing data when you don’t need it to
be highly resolved spectrally. We set the default spectral resolution to
5 because this tends to be pretty good for a lot of applications and is
in between 4 and 8 which are commonly used wavenumber resolutions.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conformed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conform_spec.html">conform_spec</a></span><span class="op">(</span><span class="va">raman_hdpe</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="smoothing">Smoothing<a class="anchor" aria-label="anchor" href="#smoothing"></a>
</h5>
<p><img src="smoothingpoly.jpg" width="266" style="display: block; margin: auto;"></p>
<p>The first step of the Open Specy preprocessing routing is spectral
smoothing. The goal of this function is to increase the signal to noise
ratio (S/N) without distorting the shape or relative size of the peaks.
The value on the slider is the polynomial order of the <a href="https://en.wikipedia.org/wiki/Savitzky%E2%80%93Golay_filter" class="external-link">Savitzky-Golay
(SG) filter</a>. The SG filter is fit to a moving window of 11 data
points where the center point in the window is replaced with the
polynomial estimate. The number of data points in the window is not user
adjustable. Higher numbers lead to more wiggly fits and thus less
smooth, lower numbers lead to more smooth fits, a 7th order polynomial
will make the spectrum have almost no smoothing. If smoothing is set to
0 then no smoothing is conducted on the spectrum. When smoothing is done
well, peak shapes and relative heights should not change. Typically a
3rd order polynomial (3 on the slider) works to increase the signal to
noise without distortion, but if the spectrum is noisy, decrease
polynomial order and if it is already smooth, increase the polynomial
order to the maximum (7). Examples of smoothing below:</p>
<div class="figure">
<img src="sop_files/figure-html/smoothing-1.png" alt="Sample `raman_hdpe` spectrum with different smoothing polynomials (p) from Cowger et al. (2020)." width="576"><p class="caption">
Sample <code>raman_hdpe</code> spectrum with different smoothing
polynomials (p) from Cowger et al. (2020).
</p>
</div>
<p>The different degrees of smoothing were achieved with the following R
commands:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/smooth_intens.html">smooth_intens</a></span><span class="op">(</span><span class="va">raman_hdpe</span>, p <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/smooth_intens.html">smooth_intens</a></span><span class="op">(</span><span class="va">raman_hdpe</span>, p <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>The intensity-adjusted sample spectrum <code>raman_adj</code> is
smoothed accordingly:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raman_smooth</span> <span class="op">&lt;-</span> <span class="va">raman_adj</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/smooth_intens.html">smooth_intens</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">raman_smooth</span><span class="op">)</span></span>
<span><span class="co">#&gt;    wavenumber  intensity</span></span>
<span><span class="co">#&gt; 1:    301.040 0.00000000</span></span>
<span><span class="co">#&gt; 2:    304.632 0.01568318</span></span>
<span><span class="co">#&gt; 3:    308.221 0.02461353</span></span>
<span><span class="co">#&gt; 4:    311.810 0.02828915</span></span>
<span><span class="co">#&gt; 5:    315.398 0.02820811</span></span>
<span><span class="co">#&gt; 6:    318.983 0.02586852</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="baseline-correction">Baseline Correction<a class="anchor" aria-label="anchor" href="#baseline-correction"></a>
</h5>
<p><img src="baselinecorrectionpoly.jpg" width="264" style="display: block; margin: auto;"></p>
<p>The second step of Open Specy’s preprocessing routine is baseline
correction. The goal of baseline correction is to get all non-peak
regions of the spectra to zero absorbance. The higher the polynomial
order, the more wiggly the fit to the baseline. If the baseline is not
very wiggly, a more wiggly fit could remove peaks which is not desired.
The baseline correction algorithm used in Open Specy is called
“iModPolyfit” (Zhao et al. 2007). This algorithm iteratively fits
polynomial equations of the specified order to the whole spectrum.
During the first fit iteration, peak regions will often be above the
baseline fit. The data in the peak region is removed from the fit to
make sure that the baseline is less likely to fit to the peaks. The
iterative fitting terminates once the difference between the new and
previous fit is small. An example of a good baseline fit below.</p>
<div class="figure">
<img src="sop_files/figure-html/subtraction-1.png" alt="Sample `raman_hdpe` spectrum with different degrees of background subtraction (Cowger et al., 2020)." width="576"><p class="caption">
Sample <code>raman_hdpe</code> spectrum with different degrees of
background subtraction (Cowger et al., 2020).
</p>
</div>
<p>The smoothed sample spectrum <code>raman_smooth</code> is
background-corrected as follows:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raman_bgc</span> <span class="op">&lt;-</span> <span class="va">raman_smooth</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="../reference/subtr_baseline.html">subtr_baseline</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">raman_bgc</span><span class="op">)</span></span>
<span><span class="co">#&gt;    wavenumber   intensity</span></span>
<span><span class="co">#&gt; 1:    301.040 0.000000000</span></span>
<span><span class="co">#&gt; 2:    304.632 0.000000000</span></span>
<span><span class="co">#&gt; 3:    308.221 0.006298355</span></span>
<span><span class="co">#&gt; 4:    311.810 0.008146146</span></span>
<span><span class="co">#&gt; 5:    315.398 0.007025667</span></span>
<span><span class="co">#&gt; 6:    318.983 0.004412447</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="range-selection">Range Selection<a class="anchor" aria-label="anchor" href="#range-selection"></a>
</h5>
<p><img src="rangeselection.jpg" width="266" style="display: block; margin: auto;"></p>
<p>The final step of processing is restricting the spectral range.
Sometimes the instrument operates with high noise at the ends of the
spectrum and sometimes the baseline fit can produce distortions at the
ends of the spectrum, both can be removed using this routine. You should
look into the signal to noise ratio of your specific instrument by
wavelength to determine what wavelength ranges to use. Distortions due
to baseline fit can be assessed from looking at the preprocess spectra
plot. Additionally, you can restrict the range to examine a single peak
or a subset of peaks of interests. This function allows users to isolate
peaks of interest for matching, while removing noise and influence from
less relevant spectral data.</p>
</div>
<div class="section level5">
<h5 id="flattening-ranges">Flattening Ranges<a class="anchor" aria-label="anchor" href="#flattening-ranges"></a>
</h5>
<p>Sometimes there a peaks that really shouldn’t be in your spectra and
can distort your interpretation of the spectra. One way to deal with
this is to replace the peak values with the mean of the values around
the peak. This is the purpose of the flatten_range function. By default
it is set to flatten the CO2 region for FTIR spectra because that region
often needs to be flattened when atmouspheric artefacts occur in
spectra.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flattened</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adj_range.html">flatten_range</a></span><span class="op">(</span><span class="va">asp_example</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="min-max-normalization">Min-Max Normalization<a class="anchor" aria-label="anchor" href="#min-max-normalization"></a>
</h5>
<p>Add in here from the previous edition.</p>
</div>
</div>
<div class="section level3">
<h3 id="identifying-spectra">Identifying Spectra<a class="anchor" aria-label="anchor" href="#identifying-spectra"></a>
</h3>
<p>After uploading data and preprocessing it (if desired) you can now
identify the spectrum. To identify the spectrum go to the <strong>Match
Spectrum</strong> tab.</p>
<p>You will see your spectrum and the top matches, but before looking at
matches, you need to check the three selectable parameters below.</p>
<div class="section level4">
<h4 id="id-library">ID Library<a class="anchor" aria-label="anchor" href="#id-library"></a>
</h4>
<p><img src="spectrumtype.jpg" width="55" style="display: block; margin: auto;"></p>
<p>The spectra type input on the “Match spectra” tab specifies the type
of spectra (Raman or FTIR) that the user has uploaded and wants to match
to. This input will tell the website whether to use the FTIR library or
the Raman library to make the match.</p>
</div>
<div class="section level4">
<h4 id="match-table">Match Table<a class="anchor" aria-label="anchor" href="#match-table"></a>
</h4>
<p><img src="matches.jpg" width="185" style="display: block; margin: auto;"></p>
<p>The selectable table shows the top material matches returned by the
tool, their Pearson’s r value, and the organization they were provided
by. When rows are selected their spectra are added to the match plot.
The spectrum being matched and reference library are determined by the
previously mentioned parameters. During the matching process, one final
cleaning step happens using a simple minimum subtraction algorithm
(Equation 2) which in many cases will allow unprocessed spectra to
remove subtle baseline, but will not harm the spectra which has no
baseline. Then, these aligned data are tested for correlation using the
Pearson’s r. The Pearson’s r is used as a match quality indicator and
the spectra from the top 1000 best matches are returned from the
library. You can restrict the libraries which are displayed in the table
by clicking the box that says <strong>All</strong> under the
Organization column.</p>
<p>Similarly you can restrict the range of Pearson's r values or search
for specific material types.</p>
<span class="math display">\[\mathrm{for~each}~peak~group^{1,n}: x -
\mathrm{min}(x)\]</span>
<p style="text-align: center;">
Equation 2: Minimum Subtraction
</p>
<p>The same table can be returned using the Open Specy library commands
in the R console.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fetch current spectral library from https://osf.io/x7dpz/</span></span>
<span><span class="fu"><a href="../reference/manage_lib.html">get_lib</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Load library into global environment</span></span>
<span><span class="va">spec_lib</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/manage_lib.html">load_lib</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Match spectrum with library and retrieve meta data</span></span>
<span><span class="fu"><a href="../reference/match_spec.html">match_spec</a></span><span class="op">(</span><span class="va">raman_bgc</span>, library <span class="op">=</span> <span class="va">spec_lib</span>, which <span class="op">=</span> <span class="st">"raman"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="selection-metadata">Selection Metadata<a class="anchor" aria-label="anchor" href="#selection-metadata"></a>
</h4>
<p><img src="selectionmetadata.jpg" width="98%" style="display: block; margin: auto;"></p>
<p>Whatever match is selected from the match table may have additional
metadata about it. That metadata will be displayed below the plot. Some
of this metadata may assist you in interpreting the spectra. For
example, if the spectra has metadata which says it is a liquid and you
are analyzing a solid particle, that spectrum may not be the best
match.</p>
<p>The R command for manual metadata selection using
<code>sample_name == 5381</code> as example is:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">find_spec</span><span class="op">(</span><span class="va">sample_name</span> <span class="op">==</span> <span class="fl">5381</span>, library <span class="op">=</span> <span class="va">spec_lib</span>, which <span class="op">=</span> <span class="st">"raman"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="match-plot">Match Plot<a class="anchor" aria-label="anchor" href="#match-plot"></a>
</h4>
<p><img src="matchplot.png" width="300" style="display: block; margin: auto;"></p>
<p>This plot is dynamically updated by selecting matches from the match
table. The red spectrum is the spectrum that you selected from the
reference library and the white spectrum is the spectrum that you are
trying to identify. Whenever a new dataset is uploaded, the plot and
data table in this tab will be updated. These plots can be saved as a
.png by clicking the camera button at the top of the plot.</p>
</div>
</div>
<div class="section level3">
<h3 id="characterizing-particles">Characterizing Particles<a class="anchor" aria-label="anchor" href="#characterizing-particles"></a>
</h3>
<div class="section level4">
<h4 id="thresholding">Thresholding<a class="anchor" aria-label="anchor" href="#thresholding"></a>
</h4>
</div>
<div class="section level4">
<h4 id="collapse-spectra">Collapse Spectra<a class="anchor" aria-label="anchor" href="#collapse-spectra"></a>
</h4>
</div>
</div>
<div class="section level3">
<h3 id="additional-app-features">Additional App Features<a class="anchor" aria-label="anchor" href="#additional-app-features"></a>
</h3>
<p>Accessibility is extremely important to us and we are making strives
to improve the accessibility of Open Specy for all spectroscopists.
Please reach out if you have ideas for improvement.</p>
<p>We added a Google translate plugin to all pages in the app so that
you can easily translate the app. We know that not all languages will be
fully supported but we will continue to try and improve the
translations.</p>
<p><img src="googletranslate.jpg" width="66" style="display: block; margin: auto;"></p>
<div class="section level4">
<h4 id="download-data">Download Data<a class="anchor" aria-label="anchor" href="#download-data"></a>
</h4>
<p><img src="download.jpg" width="120" style="display: block; margin: auto;"></p>
<p>After you have the preprocessing parameters set, we recommend that
you download the preprocessed data for your records. The download data
button will append the uploaded data to three columns created by the
preprocessing parameters. “Wavelength” and “Absorbance” are columns from
the data uploaded by the user. “NormalizedIntensity” is the max-min
normalized value (Equation 1) of the “Absorbance”. “Smoothed” is the
Savitzky-Golay filter specified by the slider explained above.
“BaselineRemoved” is the smoothed and baseline corrected value that is
visible on the center plot.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="spectroscopy-advanced">Spectroscopy Advanced<a class="anchor" aria-label="anchor" href="#spectroscopy-advanced"></a>
</h2>
<div class="section level3">
<h3 id="how-to-interpret-the-reported-matches">How to interpret the reported matches<a class="anchor" aria-label="anchor" href="#how-to-interpret-the-reported-matches"></a>
</h3>
<p>There are several important things to consider when interpreting a
spectral match including the library source, the Pearson’s r, and other
metrics.</p>
</div>
<div class="section level3">
<h3 id="the-library-source">The library source<a class="anchor" aria-label="anchor" href="#the-library-source"></a>
</h3>
<p>When you click on a spectrum, all of the metadata that we have in
Open Specy about that source will be displayed in a metadata window
below to the matches table. Each library has different methodologies
used to develop it. It is useful to read up on the library sources from
the literature that they came from. E.g. Chabuka et al. 2020 focuses on
weathered plastics, so matching to it may suggest that your spectrum is
of a weathered polymer. Primpke et al. 2018 only has a spectral range up
to 2000, so some polymers may be difficult to differentiate with it.
Make sure to cite the libraries that you use during your search when you
publish your results. The authors were kind enough to make their data
open access so that it could be used in Open Specy and we should return
the favor by citing them.</p>
</div>
<div class="section level3">
<h3 id="pearsons-r">Pearson’s r<a class="anchor" aria-label="anchor" href="#pearsons-r"></a>
</h3>
<p>Correlation values are used to identify the closest matches available
in the current Open Specy spectral libraries to improve material
identification and reduce sample processing times. Pearson’s r values
range from 0 - 1 with 0 being a completely different spectrum and 1
being an exact match. Some general guidelines that we have observed from
using Open Specy. If no matches are &gt; ~0.3 the material may require
additional processing or may not exist in the Open Specy library.
Correlation values are not the only metric you should use to assess your
spectra’s match to a material in the library, matches need to make
sense.</p>
</div>
<div class="section level3">
<h3 id="things-to-consider-beyond-correlation">Things to consider beyond correlation<a class="anchor" aria-label="anchor" href="#things-to-consider-beyond-correlation"></a>
</h3>
<p>Peak position and height similarities are more important than
correlation and need to be assessed manually. Peak position correlates
with specific bond types. Peak height correlates to the concentration of
a compound. Therefore, peak height and peak position should match as
closely as possible to the matched spectrum. When there are peaks that
exist in the spectra you are trying to interpret that do not exist in
the match, there may be additional materials to identify. In this case,
restrict the preprocessing range to just the unidentified peak and try
to identify it as an additional component (see also <a href="https://www.compoundchem.com/2015/02/05/irspectroscopy/" class="external-link">https://www.compoundchem.com/2015/02/05/irspectroscopy/</a>).</p>
<p>Also, check the match metadata to see if the match makes sense.
Example: A single fiber cannot be a “cotton blend” since there would be
no other fibers to make up the rest of the blend. Example: Cellophane
does not degrade into fibers, so a match for a fiber to cellophane
wouldn’t make sense. Example: You are analyzing a particle at room
temperature, but the matched material is liquid at room temperature. The
material may be a component of the particle but it cannot be the whole
particle.</p>
</div>
<div class="section level3">
<h3 id="how-specific-do-you-need-to-be-in-the-material-type-of-the-match">How specific do you need to be in the material type of the
match?<a class="anchor" aria-label="anchor" href="#how-specific-do-you-need-to-be-in-the-material-type-of-the-match"></a>
</h3>
<p>You can choose to be specific about how you classify a substance
(e.g. polyester, cellophane) or more general (e.g. synthetic,
semi-synthetic, natural, etc.). The choice depends on your research
question. Using more general groups can speed up analysis time but will
decrease the information you have for interpretation. To identify
materials more generally, you can often clump the identities provided by
Open Specy to suit your needs. For example, matches to “polyester” and
“polypropylene” could be clumped to the category “plastic”.</p>
</div>
<div class="section level3">
<h3 id="how-to-differentiate-between-similar-spectra">How to differentiate between similar spectra?<a class="anchor" aria-label="anchor" href="#how-to-differentiate-between-similar-spectra"></a>
</h3>
<p>One common challenge is differentiating between LDPE and HDPE. But,
even with a low resolution instrument (MacroRAM, 2 cm<sup>-1</sup>
pixel<sup>-1</sup>), you can still see some differences. From a wide
view, these low, medium, and high density PE samples all look relatively
similar (figures courtesy of Bridget O'Donnell, Horiba Scientific):</p>
<p><img src="horiba-1.png" width="300" style="display: block; margin: auto;"></p>
<p>But, a closer look at the 1450 cm<sup>-1</sup> band reveals clear
differences:</p>
<p><img src="horiba-2.png" width="300" style="display: block; margin: auto;"></p>
<p>When you overlay them, you start to see differences in other spectral
regions too:</p>
<p><img src="horiba-3.png" width="300" style="display: block; margin: auto;"></p>
<p>So, the question is, how do we deal with samples that are very
similar with only subtle differences? Usually, researchers will use MVA
techniques after they’ve collected multiple reference spectra of known
samples (LDPE and HDPE in this case). They can then develop models and
apply them to distinguish between different types of PE. With a
reference database like Open Specy, this is complicated by the fact that
researchers are measuring samples on different instruments with
correspondingly different spectral responses and spectral resolutions.
That makes it even more difficult to accurately match definitively to
LDPE and HDPE as opposed to generic ‘PE’.</p>
<p>One possibility is to place more emphasis (from a computational
perspective) on the bands that show the most difference (the triplet at
1450 cm<sup>-1</sup>) by restricting the range used to match in Open
Specy.</p>
<p>The other, much simpler option is to just match any PE hit to generic
‘PE’ and not specifically HDPE or LDPE.</p>
<p>Another challenge is in differentiating between types of nylons. But,
Raman has a pretty easy time distinguishing nylons. These spectra were
recorded of a series of nylons and the differences are much more
distinguishable compared to the PE results above (nylon 6, 6-6, 6-9,
6-10, and 6-12 top to bottom):</p>
<p><img src="horiba-4.png" width="300" style="display: block; margin: auto;"></p>
<p>The differences are even more pronounced when you overlay the
spectra:</p>
<p><img src="horiba-5.png" width="300" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="what-to-do-when-matches-arent-making-sense">What to do when matches aren’t making sense<a class="anchor" aria-label="anchor" href="#what-to-do-when-matches-arent-making-sense"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Double check that the baseline correction and smoothing parameters
result in the best preprocessing of the data.</li>
<li>Try reprocessing your spectrum, but limit it to specific peak
regions with a higher signal to noise ratio.</li>
<li>Restrict the spectral range to include or exclude questionable peaks
or peaks that were not present in the previous matches.</li>
<li>Restrict the spectral range to exclude things like CO<sub>2</sub>
(2200 cm<sup>-1</sup>) or H<sub>2</sub>O (~1600 cm<sup>-1</sup>) in
spikes in the IR spectrum.</li>
<li>If nothing above works to determine a quality match, you may need to
measure the spectrum of your material again or use another spectral
analysis tool.</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="extra-mini-tutorials">Extra Mini Tutorials<a class="anchor" aria-label="anchor" href="#extra-mini-tutorials"></a>
</h2>
<div class="section level3">
<h3 id="file-conversion-in-spectragryph">File conversion in SpectraGryph<a class="anchor" aria-label="anchor" href="#file-conversion-in-spectragryph"></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Download Spectragryph from <a href="https://www.effemm2.de/spectragryph/down.html" class="external-link">https://www.effemm2.de/spectragryph/down.html</a></p></li>
<li><p>Open Spectragryph and upload your file by dragging and dropping
it into the console.</p></li>
</ol>
<p><img src="spectragryph-1.png" width="98%" style="display: block; margin: auto;"></p>
<ol start="3" style="list-style-type: decimal">
<li>Click File, Save/export data, save data as, and save it as an spc
file. ¸</li>
</ol>
<p><img src="spectragryph-2.png" width="98%" style="display: block; margin: auto;"></p>
<ol start="4" style="list-style-type: decimal">
<li>Then upload that .spc file to Open Specy.</li>
</ol>
<p><img src="uploadfile.jpg" width="144" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="conceptual-diagram-of-open-specy">Conceptual diagram of Open Specy<a class="anchor" aria-label="anchor" href="#conceptual-diagram-of-open-specy"></a>
</h3>
<p><img src="flowchart.png" width="300" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Chabuka BK, Kalivas JH (2020). “Application of a Hybrid Fusion
Classification Process for Identification of Microplastics Based on
Fourier Transform Infrared Spectroscopy.” <em>Applied Spectroscopy</em>,
<strong>74</strong>(9), 1167–1183. doi: <a href="https://doi.org/10.1177/0003702820923993" class="external-link">10.1177/0003702820923993</a>.</p>
<p>Cowger W, Gray A, Christiansen SH, Christiansen SH, Christiansen SH,
De Frond H, Deshpande AD, Hemabessiere L, Lee E, Mill L, et al. (2020).
“Critical Review of Processing and Classification Techniques for Images
and Spectra in Microplastic Research.” <em>Applied Spectroscopy</em>,
<strong>74</strong>(9), 989–1010. doi: <a href="https://doi.org/10.1177/0003702820929064" class="external-link">10.1177/0003702820929064</a>.</p>
<p>Cowger W, Steinmetz Z, Gray A, Munno K, Lynch J, Hapich H, Primpke S,
De Frond H, Rochman C, Herodotou O (2021). “Microplastic Spectral
Classification Needs an Open Source Community: Open Specy to the
Rescue!” <em>Analytical Chemistry</em>, <strong>93</strong>(21),
7543–7548. doi: <a href="https://doi.org/10.1021/acs.analchem.1c00123" class="external-link">10.1021/acs.analchem.1c00123</a>.</p>
<p>Primpke S, Wirth M, Lorenz C, Gerdts G (2018). “Reference Database
Design for the Automated Analysis of Microplastic Samples Based on
Fourier Transform Infrared (FTIR) Spectroscopy.” <em>Analytical and
Bioanalytical Chemistry</em>, <strong>410</strong>(21), 5131–5141. doi:
<a href="https://doi.org/10.1007/s00216-018-1156-x" class="external-link">10.1007/s00216-018-1156-x</a>.</p>
<p>Renner G, Schmidt TC, Schram J (2017). “A New Chemometric Approach
for Automatic Identification of Microplastics from Environmental
Compartments Based on FT-IR Spectroscopy.” <em>Analytical
Chemistry</em>, <strong>89</strong>(22), 12045–12053. doi: <a href="https://doi.org/10.1021/acs.analchem.7b02472" class="external-link">10.1021/acs.analchem.7b02472</a>.</p>
<p>Savitzky A, Golay MJ (1964). “Smoothing and Differentiation of Data
by Simplified Least Squares Procedures.” <em>Analytical Chemistry</em>,
<strong>36</strong>(8), 1627–1639.</p>
<p>Zhao J, Lui H, McLean DI, Zeng H (2007). “Automated Autofluorescence
Background Subtraction Algorithm for Biomedical Raman Spectroscopy.”
<em>Applied Spectroscopy</em>, <strong>61</strong>(11), 1225–1232. doi:
<a href="https://doi.org/10.1366/000370207782597003" class="external-link">10.1366/000370207782597003</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Win Cowger, Zacharias Steinmetz, Nick Leong, Andrea Faltynkova.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
